Perfect â€” this is the key signal we needed.
âœ… Facts we now know (100% certain)
âœ… PostgreSQL credentials are correct
âœ… DATABASE_URL works
âœ… psql "postgresql://ace_prasad:â€¦" connects successfully
âœ… Postgres is running and listening (you just queried it)
So:
âŒ The problem is NOT Postgres
âŒ The problem is NOT credentials
âŒ The problem is NOT dotenv anymore
âš ï¸ Important correction (small but critical)
You accidentally ran this inside psql:
smucampushub=> lsof -iTCP:5432 -sTCP:LISTEN
That command must be run in your shell, not inside Postgres.
But it doesnâ€™t matter anymore â€” psql already proved TCP + auth works.
ğŸ¯ The REAL bug: your health check logic is wrong
Your app is running, DB connects fine manually, yet /api/health says:
"database": { "status": "disconnected", "error": "" }
That means one of these is true (almost certainly #1):
You never actually call await pool.query(...)
You are using a different pool/client than the one you configured
You swallowed the error and didnâ€™t log it
You created the pool but never connected it
ğŸ”¥ Letâ€™s fix this decisively (2-minute fix)
STEP 1 â€” Paste these files (needed)
Please paste exactly:
server/db.ts
the file that defines /api/health (likely routes/health.ts or similar)
Iâ€™ll patch them precisely.
âš¡ Meanwhile: guaranteed-working health check (drop-in)
If you want to unblock immediately, use this as reference.
server/db.ts
import 'dotenv/config';
import { Pool } from 'pg';

export const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

export async function checkDb() {
  const res = await pool.query('select 1 as ok');
  return res.rows[0].ok === 1;
}
/api/health route (correct version)
import { Router } from 'express';
import { checkDb } from '../db';

const router = Router();

router.get('/health', async (_req, res) => {
  try {
    await checkDb();
    res.json({
      status: 'healthy',
      database: { status: 'connected' },
      timestamp: new Date().toISOString(),
    });
  } catch (err: any) {
    res.status(500).json({
      status: 'unhealthy',
      database: {
        status: 'disconnected',
        error: err?.message ?? 'unknown error',
      },
      timestamp: new Date().toISOString(),
    });
  }
});

export default router;
ğŸ§ª After restart, expected output
curl http://localhost:5001/api/health
{
  "status": "healthy",
  "database": {
    "status": "connected"
  }
}
ğŸ§  Why this happened
This is a classic coursework bug:
Pool created âœ”
Credentials correct âœ”
Health endpoint never actually awaits a query âŒ
Or uses a different client instance âŒ
ğŸ“Œ Next step
Paste:
server/db.ts
health route file
Iâ€™ll fix your exact code, not a generic example, and youâ€™ll be done.